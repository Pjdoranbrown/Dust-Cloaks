<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dust Cloaks</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <!-- UI Overlay -->
    <div id="ui-layer" class="hidden">
        <div id="xp-bar-container"><div id="xp-bar"></div></div>
        
        <div id="top-hud" class="hud-panel">
            <div style="display:flex; flex-direction:column; align-items:center;">
                <span style="font-size:10px; color:#ddd;">CONDITION</span>
                <div id="hp-container"><div id="hp-bar"></div></div>
            </div>
            <div style="display:flex; flex-direction:column; align-items:center;">
                <span style="font-size:10px; color:#ddd;">LUCK (PRESS Q)</span>
                <div id="luck-container">
                    <div id="luck-bar"></div>
                    <div id="luck-text">0 / 10</div>
                </div>
            </div>
            <div>
                <span style="font-size:10px; color:#ddd;">TIME</span><br>
                <span id="timer" style="font-size:20px;">00:00</span>
            </div>
            <div>
                <span style="font-size:10px; color:#ddd;">SQUAD</span><br>
                <span id="squad-count" style="font-size:20px;">1/6</span>
            </div>
            <div>
                <span style="font-size:10px; color:#ddd;">LEVEL</span><br>
                <span id="level-display" style="font-size:20px;">1</span>
            </div>
            <div>
                <span style="font-size:10px; color:#ddd;">GOLD</span><br>
                <span id="gold-hud" style="font-size:20px; color: gold;">0</span>
            </div>
        </div>

        <div id="formation-indicator" class="hud-panel">
            TACTIC: <span id="tactic-name" style="color:#d4af37">WEDGE</span> <span style="font-size:12px; color:#aaa;">[SPACE]</span>
        </div>

        <div id="tutorial">
            WASD: Move<br>
            SPACE: Toggle Formation (Requires Lvl 3 Soldier)<br>
            Q: Burn Luck (Ultimate)
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="screen menu-screen">
        <h1>Dust Cloaks</h1>
        <div id="gold-display">Gold: 0</div>
        
        <div style="margin-top: 30px; display: flex; gap: 20px;">
            <button class="btn" onclick="startCreation()">RECRUIT SQUAD LEADER</button>
        </div>
        
        <div style="margin-top: 15px;">
            <button class="btn btn-small" onclick="openRoster()">ROSTER</button>
            <button class="btn btn-small" onclick="openCamp()">CAMP UPGRADES</button>
            <button class="btn btn-small" onclick="openManual()">PLAYER'S MANUAL</button>
        </div>

        <!-- VISUALS CONTAINER -->
        <div id="camp-visuals"></div>
    </div>
    
    <!-- Character Creation Screen -->
    <div id="char-creation-screen" class="screen menu-screen hidden">
        <h1 id="creation-title">Select Race</h1>
        <div id="creation-steps">
            <div id="step-race" class="creation-step active"><div id="race-selection-grid"></div></div>
            <div id="step-class" class="creation-step"><div id="char-selection-grid"></div></div>
            <div id="step-name" class="creation-step">
                <p style="font-size:24px; font-weight:bold;">Identity Confirmation</p>
                <div id="name-input-container">
                    <input type="text" id="char-name-input" placeholder="Enter Name">
                    <button class="btn btn-small" onclick="randomizeName()">Randomize</button>
                </div>
                <button class="btn" onclick="finalizeCreation()">SIGN CONTRACT</button>
            </div>
        </div>
        <button class="btn btn-small" style="margin-top: 20px;" onclick="closeCreation()">CANCEL</button>
    </div>

    <!-- Roster Screen -->
    <div id="roster-screen" class="screen menu-screen hidden">
        <h1>Active Roster</h1>
        <button class="btn btn-small" onclick="closeRoster()">BACK</button>
        <div id="roster-grid"></div>
    </div>
    
    <!-- Camp Screen -->
    <div id="camp-screen" class="screen menu-screen hidden">
        <h1>Camp Upgrades</h1>
        <div id="camp-gold" style="color:#8b0000; font-size:24px; margin-bottom:10px; font-weight:bold;">Gold: 0</div>
        <button class="btn btn-small" onclick="closeCamp()">BACK TO CONTRACTS</button>
        <div id="camp-grid"></div>
    </div>

    <!-- Manual Screen -->
    <div id="manual-screen" class="screen menu-screen hidden">
        <h1>Player's Manual</h1>
        <button class="btn btn-small" onclick="closeManual()">BACK TO MENU</button>
        <div id="manual-content"></div>
    </div>

    <!-- Level Up Screen (In-Game Overlay) -->
    <div id="levelup-screen" class="screen overlay-screen hidden">
        <h1 style="font-size: 32px;">RECRUITMENT</h1>
        <p style="color:#aaa;">Upgrade Squad or Recruit New</p>
        <div id="upgrade-grid"></div>
    </div>

    <!-- Game Over Screen (In-Game Overlay) -->
    <div id="gameover-screen" class="screen overlay-screen hidden">
        <h1 style="color: #b22222;">SQUAD BROKEN</h1>
        <p id="death-stats" style="color:#aaa;">You survived for 00:00</p>
        <button id="resurrect-btn" class="btn" style="border-color: #4169e1; color: #4169e1;" onclick="resurrectLeader()">RESURRECT LEADER (10g)</button>
        <button class="btn" onclick="location.reload()">RETURN TO GUILD</button>
    </div>

    <!-- Win Screen (In-Game Overlay) -->
    <div id="win-screen" class="screen overlay-screen hidden">
        <h1 style="color: #4169e1;">CONTRACT COMPLETE</h1>
        <p style="color:#aaa;">The area is secure.</p>
        <button class="btn" onclick="location.reload()">COLLECT PAYMENT</button>
    </div>


<script src="js/config.js"></script>
<script src="js/state.js"></script>
<script>

// ==========================================
// 3. PERSISTENCE & UTILS
// ==========================================


// ==========================================
// 4. GAME ENTITIES (CLASSES)
// ==========================================

// ==========================================
// 4. GAME ENTITIES (CLASSES)
// ==========================================

// ==========================================
// 6. UI & MENU SYSTEMS
// ==========================================

// ==========================================
// 7. GAME LOOP & LOGIC
// ==========================================

// ==========================================
// 8. INITIALIZATION
// ==========================================

window.onload = function() {
    canvas = document.getElementById('gameCanvas');
    ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    GAME.width = canvas.width;
    GAME.height = canvas.height;
    
    loadAssets();
    loadGame();
    
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        GAME.width = canvas.width; GAME.height = canvas.height;
    });

    window.addEventListener('keydown', e => {
        if(e.key === ' ' || e.key === 'Spacebar') { if(GAME.state === 'PLAY' && !keys.space) toggleFormation(); keys.space = true; }
        if(e.key.toLowerCase() === 'q') { if(GAME.state === 'PLAY' && !keys.q) burnLuck(); keys.q = true; }
        if(['w','a','s','d','ArrowUp','ArrowLeft','ArrowDown','ArrowRight'].includes(e.key)) {
            keys[e.key.toLowerCase().replace('arrowup','w').replace('arrowleft','a').replace('arrowdown','s').replace('arrowright','d')] = true;
        }
    });

    window.addEventListener('keyup', e => {
        if(e.key === ' ' || e.key === 'Spacebar') keys.space = false;
        if(e.key.toLowerCase() === 'q') keys.q = false;
        if(['w','a','s','d','ArrowUp','ArrowLeft','ArrowDown','ArrowRight'].includes(e.key)) {
            keys[e.key.toLowerCase().replace('arrowup','w').replace('arrowleft','a').replace('arrowdown','s').replace('arrowright','d')] = false;
        }
    });
};
</script>
</body>
</html>
